h1. Sending e-mail with Play

You can use the play.libs.Mail utility to send e-mail very easily:

bc. Mail.send("sender@zenexity.fr","recipient@zenexity.fr","Subject","Message");

h2. <a>Mail and MVC integration</a>

You can also send complex, dynamic e-mail using the standard templates mechanism and syntax.

First,  define a **Mailer notifier** in your application. Your mailer notifier must subclass **play.mvc.Mailer** and be part of the **notifiers** package. 

Each public static method will be an e-mail sender, in a similar manner as actions for a MVC controller.

For example:

bc. package notifiers;
 
import play.*;
import play.mvc.*;
import java.util.*;
 
public class Mails extends Mailer {
 
   public static void welcome(User user) {
      setSubject("Welcome %s", user.name);
      addRecipient(user.email);
      setFrom("Me <me@me.com>");
      addAttachment(Play.getFile("rules.pdf"));
      send(user);
   }
 
   public static void lostPassword(User user) {
      String newpassword = user.password;
      setFrom("Robot <robot@thecompany.com>");
      setSubject("Your password has been reset");
      addRecipient(user.email);
      send(user, newpassword);
   }
 
}

h3. text/html e-mail 

The send call will render the app/views/Mails/welcome.html template as the body of the e-mail message.

bc. <html><body><p>Welcome <b>${user.name}</b>, </p>
...
</html>

The template for the lostPassword method could look like this:

app/views/Mails/lostPassword.html

bc. <html><body><head>...</head><body><img src="mycompany.com/images"/><p>Hello ${user.name},<br/>
Your new password is <b>${newpassword}</b>.
</p>
</body>
</html>

h3. text/plain e-mail

If no HTML template is defined, then a text/plain e-mail is sent using the text template.

The send call will render the app/views/Mails/welcome.txt template as the body of the e-mail message.

bc. Welcome ${user.name},
...

The template for the lostPassword method could look like this:

app/views/Mails/lostPassword.txt

bc. Hello ${user.name},
 
Your new password is ${newpassword}.

h3. text/html e-mail with text/plain alternative

If an HTML template is defined and a text template exists, then the text template will be used as an alternative message. In our previous example, if both 

app/views/Mails/lostPassword.html 

and 

app/views/Mails/lostPassword.txt

are defined, then the e-mail will be sent in text/html as defined in lostPassword.html with an alternative part as defined in lostPassword.txt. So you can send nice HMTL e-mail to your friends and still please those geeky friends that still use mutt ;)

h2. <a>SMTP configuration</a>

First of all, you need to define the SMTP server to use:

bc. mail.smtp.host=smtp.taldius.net

If your SMTP server requires authentication, use the following properties: 

bc. mail.smtp.user=jfp
mail.smtp.pass=topsecret

h3. Channel & ports

There are two ways to send the e-mail over an encrypted channel. If your server supports the **starttls** command (see: RFC 2487), you can use a clear connection on port 25 that will switch to SSL/TLS. You can do so by adding this configuration option:

bc. mail.smtp.channel=starttls

Your server may also provide a SMTP-over-SSL (SMTPS) connector, that is a SSL socket listening on port 465. In that case, you tell Play to use this setup using the configuration option:

bc. mail.smtp.channel=ssl

h2. <a>More about configuration</a>

Under the hood, Play uses JavaMail to perform the actual SMTP transactions. If you need to see what’s going on, try:

bc. mail.debug=true

When using SSL connections with JavaMail, the default SSL behavior is to drop the connection if the remote server certificate is not signed by a root certificate. This is the case in particular when using a self-signed certificate. Play’s default behavior is to skip that check. You can control this using the following property:

bc. mail.smtp.socketFactory.class

If you need to connect to servers using non-standard ports, the following property will override the defaults:

bc. mail.smtp.port=2500

h2. <a>Using Gmail</a>

To use Gmail’s servers, use this configuration: 

bc. mail.smtp.host=smtp.gmail.com
mail.smtp.user=yourGmailLogin
mail.smtp.pass=yourGmailPassword
mail.smtp.channel=ssl

